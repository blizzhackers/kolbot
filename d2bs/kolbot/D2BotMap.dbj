function main () {
	include("json2.js");
	include("OOG.js");
	include("common/misc.js");
	include("common/util.js");

	let handle,
		isUp = "no";

	function copyDataEvent (mode, msg) {
		let obj;

		switch (msg) {
		case "Handle":
			handle = mode;

			break;
		}

		switch (mode) {
		case 3: // request game
			obj = JSON.parse(msg);

			if (me.gameReady) {
				D2Bot.joinMe(obj.profile, me.gamename.toLowerCase(), "", me.gamepassword.toLowerCase(), isUp);
			}

			break;
		case 4:
			// Heartbeat ping
			if (msg === "pingreq") {
				sendCopyData(null, me.windowtitle, 4, "pingrep");
			}

			break;
		}
	}

	addEventListener('copydata', copyDataEvent);

	while (!handle) {
		delay(100);
	}

	DataFile.updateStats("handle", handle);
	delay(500);
	D2Bot.init();
	load("tools/heartbeat.js");

	while (true) {
		if (me.gameReady) {
			isUp === "no" && (isUp = "yes");

			if (me.ingame) {
				D2Bot.updateStatus("Game: " + me.gamename + " | Level: " + me.charlvl);
			}

			if (me.ingame) {
				D2Bot.updateStatus("Game: " + me.gamename + " | Level: " + me.charlvl);
			}
		} else {
			D2Bot.updateStatus("Lobby");
			isUp = "no";
		}

		delay(1000);
	}
}
